---
- name: apt-get update
  apt: update_cache=yes

- name: install packages
  apt: name={{ item.pkg }} state={{ item.state }}
  with_items:
    - { pkg: build-essential,      state: present }
    - { pkg: default-jre-headless, state: present }
    - { pkg: git,                  state: present }
    - { pkg: gitweb,               state: present }
    - { pkg: tree,                 state: present }
    - { pkg: nginx,                state: present }
    - { pkg: apache2,              state: absent  }
    - { pkg: mariadb-server,       state: present }
    - { pkg: python-mysqldb,       state: present }
  notify: start mariadb

- name: export aws public dns
  shell: curl -s http://169.254.169.254/latest/meta-data/public-hostname
  register: aws_public_dns